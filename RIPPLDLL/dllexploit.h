#pragma once
#pragma warning(disable: 6387)

#include "..\RIPPL\common.hpp"

#include <shlwapi.h>
#include <shellapi.h>
#include <DbgHelp.h>

#pragma comment(lib, "Shlwapi.lib")
#pragma comment(lib, "Advapi32.lib")
#pragma comment(lib, "Shell32.lib")
#pragma comment(lib, "Dbghelp.lib")

#ifndef OPSEC
#define LOGTOCONSOLE(...) LogToConsole(__VA_ARGS__)
#define LOGLASTERROR(str) LogLastError(str)
#define DEBUGLOG(str) OutputDebugStringW(str)
#else
#define LOGTOCONSOLE(...)
#define LOGLASTERROR(str) 
#define DEBUGLOG(str)
#endif

extern HMODULE g_hInstance;
extern HANDLE g_hConsoleOutput;
extern DWORD g_dwProcessId;
extern LPWSTR g_pwszDumpFilePath;
extern LPWSTR g_pwszGuid;
extern BOOL g_bDebug;
extern int g_intExecutionMode;

typedef NTSTATUS(NTAPI* pNtSuspendProcess)(_In_  HANDLE hProcess);
typedef NTSTATUS(NTAPI* pNtResumeProcess)(_In_  HANDLE hProcess);

void DoStuff();
void LogToConsole(LPCWSTR pwszFormat, ...);
void LogLastError(LPCWSTR pwszFunctionName);
BOOL GetCurrentDllFileName(LPWSTR* ppwszDllName);
BOOL DeleteKnownDllEntry(LPCWSTR pwszDllName);
BOOL ParseCommandLine();
BOOL DumpProcessMemory(DWORD dwProcessId, LPWSTR pwszDumpFilePath);
BOOL KillProcess(DWORD dwProcessId);
BOOL ResumeProcess(DWORD dwProcessId);
BOOL SuspendProcess(DWORD dwProcessId);
BOOL JobKillProcess(DWORD dwProcessId);
BOOL JobSuppressProcess(DWORD dwProcessId);
BOOL SuicideProcess(DWORD dwProcessId);
bool UnhookDll(_In_ LPCWSTR lpszDllName);
BOOL SetPrivilege(HANDLE token, std::wstring privilege, bool enabled);
BOOL SetIntegrity(HANDLE hToken, std::wstring integrityLevel);
BOOL SandboxToken(DWORD dwProcessId);
BOOL DriverUnload(std::wstring driverName);